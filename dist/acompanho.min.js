angular.module("Acompanho",["ngAnimate","ui.bootstrap","ngSanitize","ngTouch","ngAside","ui.router","restangular","AcompanhoServices"]).config(function(e,t,n,o,r){"use strict";var i=window.navigator.userAgent,a=i.indexOf("MSIE ")>=0;n.html5Mode(!a),t.state("feeds",{url:"/",templateUrl:"partials/feeds.html",controller:"AcompanhoController"}).state("feeds.detail",{url:"feeds/:id",templateUrl:"partials/feed_detail.html",controller:"FeedDetailController"}).state("feeds.entries",{url:"feeds/:id/entries",templateUrl:"partials/entries.html",controller:"EntriesController"}),o.otherwise("/"),e.interceptors.push("ResponseStatusInterceptorService"),r.setBaseUrl("/api"),r.setDefaultHeaders({token:"tokenHere"}),r.setRestangularFields({id:"_id"})}),angular.module("Acompanho").controller("AcompanhoController",function(e,t,n,o,r,i,a,l,c){"use strict";var s=3e5;e.pageSize=20,e.acompanho={currentFeed:null},e.showMenuAside=function(){i.open({placement:"left",scope:e,controller:function(t){e.showEntriesAndDismiss=function(n){e.showEntries(n),t.dismiss("cancel")}},templateUrl:"partials/feeds_aside.html",size:"lg"})};var d=function(e){var t=r.defer();return e.newCategory?c.add(e.newCategory).then(function(e){t.resolve(e._id)}):t.resolve(e.category),t.promise};e.updateAll=function(){a.updateAll(e.categories)},e.addFeed=function(){var n=t.open({templateUrl:"partials/new_feed.html",controller:"NewFeedController",animation:!0});n.rendered.then(function(){document.querySelector("#url").focus()}),n.result.then(function(t){d(t).then(function(n){a.addFeed({url:t.newUrl,category:n}).then(function(){e.updateFeedList()})})})},e.selectFeed=function(t){e.categories?e.categories.forEach(function(n){n.feeds.forEach(function(n){n.selected=!1,t._id===n._id&&(e.acompanho.currentFeed=n,n.selected=!0)})}):(e.feedSelectedBeforeCat=!0,e.acompanho.currentFeed=t)},e.showEntries=function(e){o.go("feeds.entries",{id:e._id})},e.updateFeedList=function(){c.listWithFeeds().then(function(t){e.categories=t,e.updateAll()})},e.pageChanged=function(t){a.allUnreadEntries(t,e.pageSize).then(function(t){e.entries=t.entries,e.totalEntries=t.total})};var u=function(e){i.open({placement:"right",controller:function(t,n){t.entry=e,t.close=function(){n.dismiss("cancel")}},templateUrl:"partials/entry.html",size:"lg"})};e.openEntry=function(t){t.description||(t.loading=!0,a.readEntry(t).then(function(n){t.loading=!1,t.description=n,t.unread=!1,e.acompanho.currentFeed?e.acompanho.currentFeed.unreadCount--:e.pageChanged(1)})),u(t)};var f=function(){c.listWithFeeds().then(function(t){e.categories=t,n.hideSplash=!0,e.feedSelectedBeforeCat&&e.selectFeed(e.acompanho.currentFeed),e.updateAll(),setInterval(e.updateAll,s)}),l.getUser().then(function(t){e.user=t}),e.pageChanged(1)};e.goHome=function(){e.acompanho.currentFeed=null,o.go("feeds"),f()},f()}),angular.module("Acompanho").controller("ConfirmDialogController",function(e,t,n){e.confirmMessage=n.confirmMessage,e.ok=function(){t.close()},e.cancel=function(){t.dismiss("cancel")}}),angular.module("Acompanho").controller("EntriesController",function(e,t,n,o){"use strict";e.pageSize=20,e.pageChanged=function(r){o.findEntries(t.id,r,e.pageSize).then(function(t){e.entries=t.entries,e.entries.forEach(function(e){n.trustAsHtml(e.description),n.trustAsHtml(e.summary)}),e.totalEntries=t.total})};var r=function(){o.getFeedById(t.id).then(function(t){e.selectFeed(t)}),e.pageChanged(1)};r()}),angular.module("Acompanho").controller("FeedDetailController",function(e,t,n,o,r,i){"use strict";e.save=function(){o.updateFeed(e.editFeed).then(function(){n.go("feeds.entries",{id:e.editFeed._id}),e.updateFeedList()})},e.cancel=function(){n.go("feeds.entries",{id:e.editFeed._id})},e["delete"]=function(){var t="Deseja realmente excluir o feed "+e.editFeed.title+"?";r.showConfirmDialog(t,function(){o.deleteFeed(e.editFeed).then(function(){e.acompanho.currentFeed=null,n.go("feeds"),e.updateFeedList()})})};var a=function(){i.list().then(function(t){e.categories=t}),o.getFeedById(t.id).then(function(t){e.editFeed=t})};a()}),angular.module("Acompanho").controller("NewFeedController",function(e,t,n){"use strict";e.ok=function(){t.close({newUrl:e.newUrl,category:e.category,newCategory:e.nova?e.newCategory:null})},e.cancel=function(){t.dismiss("cancel")};var o=function(){n.list().then(function(t){e.categories=t})};o()}),angular.module("Acompanho").filter("limitWordWise",function(){"use strict";return function(e,t){if(!e)return"";if(t=parseInt(t,10),!t)return e;if(e.length<=t)return e;e=e.substr(0,t);var n=e.lastIndexOf(" ");return-1!=n&&(e=e.substr(0,n)),e+"â€¦"}});