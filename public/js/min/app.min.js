angular.module("AcompanhoServices",[]),angular.module("AcompanhoServices").factory("CategoryService",function(e){"use strict";var t={};return t.list=function(){return e.all("categories").getList()},t.listWithFeeds=function(){return e.all("categories").getList({feeds:!0})},t.add=function(t){return e.all("categories").post({name:t})},t}),angular.module("AcompanhoServices").factory("DialogService",function(e){"use strict";var t={};return t.showConfirmDialog=function(t,n){this.confirmMessage=t;var r=e.open({templateUrl:"partials/confirm_dialog.html",controller:"ConfirmDialogController",animation:!0});r.result.then(n)},t}),angular.module("AcompanhoServices").factory("EntryService",function(e){"use strict";var t={};return t.find=function(t,n){return e.one("entries",t).get({read:n})},t}),angular.module("AcompanhoServices").factory("FeedService",function(e,t){"use strict";var n={};return n.findEntries=function(t,n,r){return e.one("feeds",t).one("entries").get({page:n,pageSize:r})},n.allUnreadEntries=function(t,n){return e.one("entries").get({page:t,pageSize:n,unread:!0})},n.getFeedById=function(t){return e.one("feeds",t).get()},n.addFeed=function(t){return e.all("feeds").post(t)},n.updateFeed=function(e){return e.put()},n.deleteFeed=function(e){return e.remove()},n.updateAll=function(e){var r=t.defer(),o=[];return e.forEach(function(e){e.feeds.forEach(function(e){e.updating=!0,o.push(n.refreshEntries(e).then(function(){e.updating=!1}))})}),t.all(o).then(function(){r.resolve()}),r.promise},n.refreshEntries=function(t){return e.one("feeds",t._id).one("entries").one("update").get().then(function(e){e.error?t.failedUpdate=!0:(t.failedUpdate=!1,n.updateCount(t))})},n.readEntry=function(t){return e.one("entries",t._id).one("read").get().then(function(e){return e.description})},n.updateCount=function(t){e.one("feeds",t._id).one("unread_count").get().then(function(e){t.unreadCount=e})},n}),angular.module("AcompanhoServices").factory("ResponseStatusInterceptorService",function(e){"use strict";var t={};return t.responseError=function(t){if(401===t.status)window.location="/login";else if(500===t.status){var n="Ocorreu um erro";t.data.error&&(n+=": "+t.data.error),alert(n+".")}else 404===t.status&&console.log("Not found");return e.reject(t)},t}),angular.module("AcompanhoServices").factory("UserService",function(e){"use strict";var t={};return t.getUser=function(){return e.one("user").get()},t}),angular.module("Acompanho",["ngAnimate","ui.bootstrap","ngSanitize","ngTouch","ngAside","ui.router","restangular","AcompanhoServices"]).config(function(e,t,n,r,o){"use strict";var i=window.navigator.userAgent,a=i.indexOf("MSIE ")>=0;n.html5Mode(!a),t.state("feeds",{url:"/",templateUrl:"partials/feeds.html",controller:"AcompanhoController"}).state("feeds.detail",{url:"feeds/:id",templateUrl:"partials/feed_detail.html",controller:"FeedDetailController"}).state("feeds.entries",{url:"feeds/:id/entries",templateUrl:"partials/entries.html",controller:"EntriesController"}),r.otherwise("/"),e.interceptors.push("ResponseStatusInterceptorService"),o.setBaseUrl("/api"),o.setDefaultHeaders({token:"tokenHere"}),o.setRestangularFields({id:"_id"})}),angular.module("Acompanho").controller("AcompanhoController",function(e,t,n,r,o,i,a,c,u){"use strict";var s=3e5;e.pageSize=20,e.acompanho={currentFeed:null},e.showMenuAside=function(){i.open({placement:"left",scope:e,controller:function(t){e.showEntriesAndDismiss=function(n){e.showEntries(n),t.dismiss("cancel")}},templateUrl:"partials/feeds_aside.html",size:"lg"})};var l=function(e){var t=o.defer();return e.newCategory?u.add(e.newCategory).then(function(e){t.resolve(e._id)}):t.resolve(e.category),t.promise};e.updateAll=function(){a.updateAll(e.categories)},e.addFeed=function(){var n=t.open({templateUrl:"partials/new_feed.html",controller:"NewFeedController",animation:!0});n.rendered.then(function(){document.querySelector("#url").focus()}),n.result.then(function(t){l(t).then(function(n){a.addFeed({url:t.newUrl,category:n}).then(function(){e.updateFeedList()})})})},e.selectFeed=function(t){e.categories?e.categories.forEach(function(n){n.feeds.forEach(function(n){n.selected=!1,t._id===n._id&&(e.acompanho.currentFeed=n,n.selected=!0)})}):(e.feedSelectedBeforeCat=!0,e.acompanho.currentFeed=t)},e.showEntries=function(e){r.go("feeds.entries",{id:e._id})},e.updateFeedList=function(){u.listWithFeeds().then(function(t){e.categories=t,e.updateAll()})},e.pageChanged=function(t){a.allUnreadEntries(t,e.pageSize).then(function(t){e.entries=t.entries,e.totalEntries=t.total})};var d=function(e){i.open({placement:"right",controller:function(t,n){t.entry=e,t.close=function(){n.dismiss("cancel")}},templateUrl:"partials/entry.html",size:"lg"})};e.openEntry=function(t){t.description||(t.loading=!0,a.readEntry(t).then(function(n){t.loading=!1,t.description=n,t.unread=!1,e.acompanho.currentFeed?e.acompanho.currentFeed.unreadCount--:e.pageChanged(1)})),d(t)};var f=function(){u.listWithFeeds().then(function(t){e.categories=t,n.hideSplash=!0,e.feedSelectedBeforeCat&&e.selectFeed(e.acompanho.currentFeed),e.updateAll(),setInterval(e.updateAll,s)}),c.getUser().then(function(t){e.user=t}),e.pageChanged(1)};e.goHome=function(){e.acompanho.currentFeed=null,r.go("feeds"),f()},f()}),angular.module("Acompanho").controller("ConfirmDialogController",function(e,t,n){e.confirmMessage=n.confirmMessage,e.ok=function(){t.close()},e.cancel=function(){t.dismiss("cancel")}}),angular.module("Acompanho").controller("EntriesController",function(e,t,n,r){"use strict";e.pageSize=20,e.pageChanged=function(o){r.findEntries(t.id,o,e.pageSize).then(function(t){e.entries=t.entries,e.entries.forEach(function(e){n.trustAsHtml(e.description),n.trustAsHtml(e.summary)}),e.totalEntries=t.total})};var o=function(){r.getFeedById(t.id).then(function(t){e.selectFeed(t)}),e.pageChanged(1)};o()}),angular.module("Acompanho").controller("FeedDetailController",function(e,t,n,r,o,i){"use strict";e.save=function(){r.updateFeed(e.editFeed).then(function(){n.go("feeds.entries",{id:e.editFeed._id}),e.updateFeedList()})},e.cancel=function(){n.go("feeds.entries",{id:e.editFeed._id})},e["delete"]=function(){var t="Deseja realmente excluir o feed "+e.editFeed.title+"?";o.showConfirmDialog(t,function(){r.deleteFeed(e.editFeed).then(function(){e.acompanho.currentFeed=null,n.go("feeds"),e.updateFeedList()})})};var a=function(){i.list().then(function(t){e.categories=t}),r.getFeedById(t.id).then(function(t){e.editFeed=t})};a()}),angular.module("Acompanho").controller("NewFeedController",function(e,t,n){"use strict";e.ok=function(){t.close({newUrl:e.newUrl,category:e.category,newCategory:e.nova?e.newCategory:null})},e.cancel=function(){t.dismiss("cancel")};var r=function(){n.list().then(function(t){e.categories=t})};r()}),angular.module("Acompanho").filter("limitWordWise",function(){"use strict";return function(e,t){if(!e)return"";if(t=parseInt(t,10),!t)return e;if(e.length<=t)return e;e=e.substr(0,t);var n=e.lastIndexOf(" ");return-1!=n&&(e=e.substr(0,n)),e+"â€¦"}});