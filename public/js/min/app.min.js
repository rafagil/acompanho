angular.module("AcompanhoServices",[]),angular.module("AcompanhoServices").factory("CategoryService",["Restangular",function(e){"use strict";var n={};return n.list=function(){return e.all("categories").getList()},n.listWithFeeds=function(){return e.all("categories").getList({feeds:!0})},n.add=function(n){return e.all("categories").post({name:n})},n}]),angular.module("AcompanhoServices").factory("DialogService",["$modal","$q",function(e,n){"use strict";var t={};return t.showConfirmDialog=function(t){var r=n.defer();this.confirmMessage=t;var o=e.open({templateUrl:"partials/confirm_dialog.html",controller:"ConfirmDialogController",animation:!0});return o.result.then(function(){r.resolve()}),r.promise},t}]),angular.module("AcompanhoServices").factory("EntryService",["Restangular",function(e){"use strict";var n={};return n.find=function(n,t){return e.one("entries",n).get({read:t})},n}]),angular.module("AcompanhoServices").factory("FeedService",["Restangular","$q",function(e,n){"use strict";var t={};return t.findEntries=function(n,t,r){return e.one("feeds",n).one("entries").get({page:t,pageSize:r})},t.allUnreadEntries=function(n,t){return e.one("entries").get({page:n,pageSize:t,unread:!0})},t.getFeedById=function(n){return e.one("feeds",n).get()},t.addFeed=function(n){return e.all("feeds").post(n)},t.updateFeed=function(e){return e.put()},t.deleteFeed=function(e){return e.remove()},t.updateAll=function(e){var r=n.defer(),o=[];return e.forEach(function(e){e.feeds.forEach(function(e){e.updating=!0,o.push(t.refreshEntries(e).then(function(){e.updating=!1}))})}),n.all(o).then(function(){r.resolve()}),r.promise},t.refreshEntries=function(n){return e.one("feeds",n._id).one("entries").one("update").get().then(function(e){e.error?n.failedUpdate=!0:(n.failedUpdate=!1,t.updateCount(n))})},t.readEntry=function(n){return e.one("entries",n._id).one("read").get().then(function(e){return e.description})},t.updateCount=function(n){e.one("feeds",n._id).one("unread_count").get().then(function(e){n.unreadCount=e})},t}]),angular.module("AcompanhoServices").factory("ResponseStatusInterceptorService",["$q",function(e){"use strict";var n={};return n.responseError=function(n){if(401===n.status)window.location="/login";else if(500===n.status){var t="Ocorreu um erro";n.data.error&&(t+=": "+n.data.error),alert(t+".")}else 404===n.status&&console.log("Not found");return e.reject(n)},n}]),angular.module("AcompanhoServices").factory("UserService",["Restangular",function(e){"use strict";var n={};return n.getUser=function(){return e.one("user").get()},n}]),angular.module("Acompanho",["ngAnimate","ui.bootstrap","ngSanitize","ngTouch","ngAside","ui.router","restangular","AcompanhoServices"]).config(["$httpProvider","$stateProvider","$locationProvider","$urlRouterProvider","RestangularProvider",function(e,n,t,r,o){"use strict";var i=window.navigator.userAgent,a=i.indexOf("MSIE ")>=0;t.html5Mode(!a),n.state("feeds",{url:"/",templateUrl:"partials/feeds.html",controller:"AcompanhoController"}).state("feeds.detail",{url:"feeds/:id",templateUrl:"partials/feed_detail.html",controller:"FeedDetailController"}).state("feeds.entries",{url:"feeds/:id/entries",templateUrl:"partials/entries.html",controller:"EntriesController"}).state("feeds.unread",{url:"unread",templateUrl:"partials/unread.html",controller:"UnreadEntriesController"}),r.otherwise("/"),e.interceptors.push("ResponseStatusInterceptorService"),o.setBaseUrl("/api"),o.setRestangularFields({id:"_id"})}]),angular.module("Acompanho").controller("AcompanhoController",["$scope","$modal","$rootScope","$state","$q","$aside","FeedService","UserService","CategoryService",function(e,n,t,r,o,i,a,c,s){"use strict";var l=3e5;e.acompanho={currentFeed:null},e.showMenuAside=function(){i.open({placement:"left",scope:e,controller:function(n){e.showEntriesAndDismiss=function(t){e.showEntries(t),n.dismiss("cancel")}},templateUrl:"partials/feeds_aside.html",size:"lg"})};var u=function(e){var n=o.defer();return e.newCategory?s.add(e.newCategory).then(function(e){n.resolve(e._id)}):n.resolve(e.category),n.promise};e.updateAll=function(){a.updateAll(e.categories)},e.addFeed=function(){var t=n.open({templateUrl:"partials/new_feed.html",controller:"NewFeedController",animation:!0});t.rendered.then(function(){document.querySelector("#url").focus()}),t.result.then(function(n){u(n).then(function(t){a.addFeed({url:n.newUrl,category:t}).then(function(){e.updateFeedList()})})})},e.selectFeed=function(n){e.categories?e.categories.forEach(function(t){t.feeds.forEach(function(t){t.selected=!1,n._id===t._id&&(e.acompanho.currentFeed=t,t.selected=!0)})}):(e.feedSelectedBeforeCat=!0,e.acompanho.currentFeed=n)},e.showEntries=function(e){r.go("feeds.entries",{id:e._id})},e.updateFeedList=function(){s.listWithFeeds().then(function(n){e.categories=n,e.updateAll()})};var d=function(){s.listWithFeeds().then(function(n){e.categories=n,t.hideSplash=!0,e.feedSelectedBeforeCat&&e.selectFeed(e.acompanho.currentFeed),e.updateAll(),setInterval(e.updateAll,l)}),c.getUser().then(function(n){e.user=n}),r.is("feeds")&&r.go("feeds.unread")};e.goHome=function(){e.acompanho.currentFeed=null,r.go("feeds"),d()},d()}]),angular.module("Acompanho").controller("ConfirmDialogController",["$scope","$modalInstance","DialogService",function(e,n,t){"use strict";e.confirmMessage=t.confirmMessage,e.ok=function(){n.close()},e.cancel=function(){n.dismiss("cancel")}}]),angular.module("Acompanho").controller("EntriesController",["$scope","$stateParams","$sce","$aside","FeedService",function(e,n,t,r,o){"use strict";e.pageSize=10;var i=function(e){r.open({placement:"right",controller:["$scope","$modalInstance",function(n,t){n.entry=e,n.close=function(){t.dismiss("cancel")}}],templateUrl:"partials/entry.html",size:"lg"})};e.openEntry=function(n){n.description||(n.loading=!0,o.readEntry(n).then(function(t){n.loading=!1,n.description=t,n.unread=!1,e.acompanho.currentFeed.unreadCount--})),i(n)},e.pageChanged=function(r){o.findEntries(n.id,r,e.pageSize).then(function(n){e.entries=n.entries,e.entries.forEach(function(e){t.trustAsHtml(e.description),t.trustAsHtml(e.summary)}),e.totalEntries=n.total})};var a=function(){o.getFeedById(n.id).then(function(n){e.selectFeed(n)}),e.pageChanged(1)};a()}]),angular.module("Acompanho").controller("FeedDetailController",["$scope","$stateParams","$state","FeedService","DialogService","CategoryService",function(e,n,t,r,o,i){"use strict";e.save=function(){r.updateFeed(e.editFeed).then(function(){t.go("feeds.entries",{id:e.editFeed._id}),e.updateFeedList()})},e.cancel=function(){t.go("feeds.entries",{id:e.editFeed._id})},e["delete"]=function(){var n="Deseja realmente excluir o feed "+e.editFeed.title+"?";o.showConfirmDialog(n).then(function(){return r.deleteFeed(e.editFeed)}).then(function(){e.acompanho.currentFeed=null,t.go("feeds"),e.updateFeedList()})};var a=function(){i.list().then(function(n){e.categories=n}),r.getFeedById(n.id).then(function(n){e.editFeed=n})};a()}]),angular.module("Acompanho").controller("NewFeedController",["$scope","$modalInstance","CategoryService",function(e,n,t){"use strict";e.ok=function(){n.close({newUrl:e.newUrl,category:e.category,newCategory:e.nova?e.newCategory:null})},e.cancel=function(){n.dismiss("cancel")};var r=function(){t.list().then(function(n){e.categories=n})};r()}]),angular.module("Acompanho").controller("UnreadEntriesController",["$scope","$aside","FeedService",function(e,n,t){"use strict";e.pageSize=10;var r=function(e){n.open({placement:"right",controller:["$scope","$modalInstance",function(n,t){n.entry=e,n.close=function(){t.dismiss("cancel")}}],templateUrl:"partials/entry.html",size:"lg"})},o=function(n){e.categories.forEach(function(e){e.feeds.forEach(function(e){e._id===n._id&&e.unreadCount--})})};e.openEntry=function(n){n.description||(n.loading=!0,t.readEntry(n).then(function(t){n.loading=!1,n.description=t,n.unread=!1,o(n.feed),e.pageChanged(1)})),r(n)},e.pageChanged=function(n){e.loading=!0,t.allUnreadEntries(n,e.pageSize).then(function(n){e.entries=n.entries,e.totalEntries=n.total,e.loading=!1})};var i=function(){e.categories&&e.categories.forEach(function(e){e.feeds.forEach(function(e){e.selected=!1})}),e.acompanho.currentFeed=null,e.pageChanged(1)};i()}]),angular.module("Acompanho").filter("limitWordWise",function(){"use strict";return function(e,n){if(!e)return"";if(n=parseInt(n,10),!n)return e;if(e.length<=n)return e;e=e.substr(0,n);var t=e.lastIndexOf(" ");return-1!==t&&(e=e.substr(0,t)),e+"â€¦"}});